<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<body></body>
<script>
 class EventEmitter {
   constructor() {
     this.register = {};
   }
   
   on(event, cb) {
     this.register[event] = e => cb(e.detail);
     document.addEventListener(event, this.register[event], true);
   }

   once(event, cb) {
     document.addEventListener(event, function onceHandler(e) {
       cb(e.detail);
       document.removeEventListener(event, onceHandler, true);
     }, true);
   }

   fire(event, p) {
     document.dispatchEvent(new CustomEvent(event, {detail: p}));
   }

   off(event) {
     document.removeEventListener(event, this.register[event], true);
   }
 }
 /** 封装 Event 事件.2
  * + 携带 data 的 Event 类 CustomEvent
  * + addListener / removeListener 需要引用同一 function
  **/
 const event = new EventEmitter()
 event.on('drink', (person) => {
   console.log(person + '喝水');
 })
 event.on('eat', (person) => {
   console.log(person + '吃东西');
 })
 event.once('buy', (person) => {
   console.log(person + '买东西');
 })
 event.fire('drink', '我')   // 我喝水
 event.fire('drink', '我')   // 我喝水
 event.fire('eat', '其它人') // 其它人吃东西
 event.fire('eat', '其它人') // 其它人吃东西
 event.fire('buy', '其它人') // 其它人买东西
 event.fire('buy', '其它人') // 这里不会再次触发buy事件，因为once只能触发一次
 event.off('eat')            // 移除eat事件
 event.fire('eat', '其它人') // 这里不会再次触发eat事件，因为eat已移除
</script>
